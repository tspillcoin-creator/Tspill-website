<!doctype html>
<html lang="en">
<head>
  <!DOCTYPE html>
<html>
<head>
    <!-- PASTE YOUR GOOGLE TAG CODE RIGHT HERE -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9LGL99DKPE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9LGL99DKPE');
    </script>
    <!-- Your other meta tags, title, and CSS links go below -->
    <meta charset="UTF-8">
    <title>TSPILL Universe</title>
    ...
</head>
<body>
...
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSPILL Universe ‚Äî Your Feelings, Immortalized</title>
  <meta name="description" content="Light a star with your feelings. Pay 1 USD, share your emotion, watch it float forever in the digital universe." />
  
  <!-- Open Graph Meta Tags for Social Sharing -->
  <meta property="og:title" content="TSPILL Universe" />
  <meta property="og:description" content="Your feelings, immortalized on the blockchain" />
  <meta property="og:image" content="https://tspill.fun/og-image.png" />
  <meta property="og:url" content="https://tspill.fun" />
  <meta name="twitter:card" content="summary_large_image" />
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåå</text></svg>">
  
  <style>
    /* ===== CSS RESET & VARIABLES ===== */
    :root {
      --primary: #8c5a24;
      --primary-hover: #a46829;
      --secondary: #14f195;
      --dark: #0b0f14;
      --darker: #070a0f;
      --light: #e8f0ff;
      --gray: #9fb3d1;
      --card-bg: rgba(14, 20, 32, 0.96);
      --border: #1c2538;
      --success: #8ee5a1;
      --warning: #ffd57a;
      --error: #ffa7a7;
      
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      scroll-behavior: smooth;
      scroll-padding-top: 100px;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--dark);
      color: var(--light);
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    /* ===== BACKGROUND EFFECTS ===== */
    .universe-bg {
      position: fixed;
      inset: 0;
      z-index: -2;
      background: 
        radial-gradient(1200px 800px at 15% 20%, rgba(140, 90, 36, 0.07) 0%, transparent 55%),
        radial-gradient(900px 600px at 85% 30%, rgba(65, 90, 140, 0.06) 0%, transparent 55%),
        radial-gradient(1000px 700px at 50% 90%, rgba(20, 30, 48, 0.06) 0%, transparent 55%),
        linear-gradient(180deg, var(--darker) 0%, var(--dark) 100%);
      animation: bg-pulse 20s ease-in-out infinite;
    }
    
    @keyframes bg-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.9; }
    }
    
    .star-particle {
      position: fixed;
      background: white;
      border-radius: 50%;
      animation: twinkle linear infinite;
      z-index: -1;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    
    /* ===== TYPOGRAPHY ===== */
    h1, h2, h3, h4 {
      font-weight: 700;
      line-height: 1.2;
    }
    
    h1 {
      font-size: clamp(2.5rem, 5vw, 3.5rem);
      background: linear-gradient(135deg, var(--light) 0%, var(--gray) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: var(--space-md);
    }
    
    h2 {
      font-size: clamp(2rem, 4vw, 2.5rem);
      margin-bottom: var(--space-lg);
    }
    
    h3 {
      font-size: 1.5rem;
      margin-bottom: var(--space-md);
    }
    
    .lead {
      font-size: 1.25rem;
      color: var(--gray);
      margin-bottom: var(--space-xl);
      max-width: 800px;
    }
    
    /* ===== LAYOUT ===== */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--space-lg);
    }
    
    .section {
      padding: var(--space-2xl) 0;
    }
    
    /* ===== NAVIGATION ===== */
    .navbar {
      position: sticky;
      top: 0;
      background: rgba(11, 15, 20, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      z-index: 100;
      padding: var(--space-md) 0;
    }
    
    .nav-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-lg);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      text-decoration: none;
    }
    
    .brand-logo {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .brand-text h2 {
      margin: 0;
      font-size: 1.5rem;
    }
    
    .brand-text span {
      font-size: 0.875rem;
      color: var(--gray);
    }
    
    .nav-menu {
      display: flex;
      gap: var(--space-md);
      list-style: none;
    }
    
    .nav-link {
      color: var(--light);
      text-decoration: none;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      transition: all 0.2s;
      font-weight: 500;
    }
    
    .nav-link:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .nav-link.active {
      background: var(--primary);
      color: white;
    }
    
    /* ===== HERO SECTION ===== */
    .hero {
      text-align: center;
      padding: var(--space-2xl) 0;
      position: relative;
    }
    
    .hero-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: var(--space-sm) var(--space-lg);
      border-radius: 100px;
      font-size: 0.875rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: var(--space-xl);
    }
    
    /* ===== STARFIELD ===== */
    .starfield-container {
      width: 100%;
      height: 70vh;
      min-height: 500px;
      max-height: 800px;
      background: linear-gradient(180deg, rgba(10, 15, 35, 0.9) 0%, rgba(15, 20, 50, 0.7) 100%);
      border: 2px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      position: relative;
      margin: var(--space-xl) 0;
    }
    
    .star {
      position: absolute;
      width: 32px;
      height: 32px;
      cursor: pointer;
      animation: float linear infinite;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .star::before {
      content: '‚ú¶';
      font-size: 24px;
      color: #d4a574;
      text-shadow: 0 0 20px rgba(212, 165, 116, 0.8);
      transition: all 0.3s ease;
    }
    
    .star:hover::before {
      transform: scale(1.5);
      text-shadow: 0 0 40px rgba(212, 165, 116, 1);
    }
    
    @keyframes float {
      0% { transform: translateY(0px) rotate(0deg); }
      100% { transform: translateY(20px) rotate(360deg); }
    }
    
    /* ===== CARDS ===== */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--space-lg);
      margin: var(--space-xl) 0;
    }
    
    /* ===== BUTTONS ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      padding: var(--space-md) var(--space-xl);
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }
    
    .btn:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(140, 90, 36, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-secondary {
      background: transparent;
      border: 2px solid var(--border);
      color: var(--light);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--primary);
    }
    
    .btn-lg {
      padding: var(--space-lg) var(--space-2xl);
      font-size: 1.125rem;
    }
    
    /* ===== WALLET CONNECTION ===== */
    .wallet-btn {
      position: fixed;
      top: var(--space-lg);
      right: var(--space-lg);
      z-index: 1000;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-md) var(--space-lg);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    
    .wallet-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    }
    
    .wallet-btn.connected {
      background: var(--success);
      padding: var(--space-sm) var(--space-md);
    }
    
    /* ===== MODAL ===== */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: var(--space-lg);
    }
    
    .modal.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-xl);
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 24px;
      cursor: pointer;
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
      transition: all 0.2s;
    }
    
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--light);
    }
    
    /* ===== FORM ELEMENTS ===== */
    .form-group {
      margin-bottom: var(--space-xl);
    }
    
    .form-label {
      display: block;
      margin-bottom: var(--space-sm);
      font-weight: 600;
      color: var(--light);
    }
    
    .form-input,
    .form-textarea {
      width: 100%;
      padding: var(--space-md);
      background: rgba(11, 18, 32, 0.8);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--light);
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.2s;
    }
    
    .form-input:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(140, 90, 36, 0.1);
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    /* ===== STATS ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-md);
      margin: var(--space-xl) 0;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      text-align: center;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: var(--space-sm);
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* ===== LOADING STATES ===== */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ===== FOOTER ===== */
    .footer {
      background: rgba(7, 10, 15, 0.9);
      border-top: 1px solid var(--border);
      padding: var(--space-2xl) 0;
      margin-top: var(--space-2xl);
    }
    
    .footer-content {
      text-align: center;
      color: var(--gray);
    }
    
    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .nav-content {
        flex-direction: column;
        gap: var(--space-md);
      }
      
      .nav-menu {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .wallet-btn {
        position: relative;
        top: 0;
        right: 0;
        width: 100%;
        margin: var(--space-md) 0;
      }
      
      .starfield-container {
        height: 50vh;
        min-height: 400px;
      }
      
      .section {
        padding: var(--space-xl) 0;
      }
    }
    
    /* ===== UTILITY CLASSES ===== */
    .text-center { text-align: center; }
    .text-gradient {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .mb-sm { margin-bottom: var(--space-sm); }
    .mb-md { margin-bottom: var(--space-md); }
    .mb-lg { margin-bottom: var(--space-lg); }
    .mb-xl { margin-bottom: var(--space-xl); }
    .mt-sm { margin-top: var(--space-sm); }
    .mt-md { margin-top: var(--space-md); }
    .mt-lg { margin-top: var(--space-lg); }
    .mt-xl { margin-top: var(--space-xl); }
    .hidden { display: none; }
    .fade-in {
      animation: fadeIn 0.5s ease;
    }
    
    /* ===== TOAST NOTIFICATION ===== */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-md);
      z-index: 10000;
      animation: slideIn 0.3s ease;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .toast.error { background: var(--error); }
    .toast.warning { background: var(--warning); color: #333; }
    .toast.info { background: var(--primary); }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
  </style>
</head>
<body>
  <!-- Background Elements -->
  <div class="universe-bg"></div>
  <div id="starParticles"></div>
  
  <!-- Skip to Content -->
  <a href="#main" class="skip-link" style="position: absolute; left: -9999px; top: auto;">Skip to content</a>
  
  <!-- Wallet Connection Button -->
  <button id="walletBtn" class="wallet-btn">
    <span>üîó</span>
    <span id="walletText">Connect Wallet</span>
  </button>
  
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <div class="nav-content">
        <a href="#" class="brand">
          <div class="brand-logo">üåå</div>
          <div class="brand-text">
            <h2>TSPILL Universe</h2>
            <span>Your feelings, immortalized</span>
          </div>
        </a>
        
        <ul class="nav-menu">
          <li><a href="#universe" class="nav-link active">Universe</a></li>
          <li><a href="#how" class="nav-link">How It Works</a></li>
          <li><a href="#about" class="nav-link">About TSPILL</a></li>
          <li><a href="#transparency" class="nav-link">Transparency</a></li>
        </ul>
      </div>
    </div>
  </nav>
  
  <!-- Main Content -->
  <main id="main">
    <!-- Hero Section -->
    <section id="universe" class="section">
      <div class="container">
        <div class="hero">
          <span class="hero-badge">üéØ Launch Exclusive</span>
          <h1>Light Your Star<br>in the Digital Universe</h1>
          <p class="lead">
            Share your deepest feelings, wildest dreams, or rawest emotions. 
            Pay 1 USD, watch your star appear instantly, and become part of 
            our collective cosmic tapestry.
          </p>
          
          <div class="starfield-container" id="starfield">
            <!-- Stars will be generated here -->
          </div>
          
          <button id="lightStarBtn" class="btn btn-lg">
            ‚ú® Light Your Star (1 USD)
          </button>
          
          <!-- Live Stats -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="totalStars">0</div>
              <div class="stat-label">Stars Lit</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="totalRaised">$0.00</div>
              <div class="stat-label">Total Raised</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="liveUsers">0</div>
              <div class="stat-label">Live Now</div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- How It Works -->
    <section id="how" class="section">
      <div class="container">
        <h2 class="text-center">Simple & Magical</h2>
        <p class="lead text-center mb-xl">Three steps to immortality</p>
        
        <div class="grid">
          <div class="card">
            <div class="text-gradient mb-md" style="font-size: 3rem;">1</div>
            <h3>Click & Connect</h3>
            <p>Click any star spot and connect your Phantom wallet. No registration needed.</p>
          </div>
          
          <div class="card">
            <div class="text-gradient mb-md" style="font-size: 3rem;">2</div>
            <h3>Share Your Feeling</h3>
            <p>Type your message (max 500 characters). Be authentic, be you.</p>
          </div>
          
          <div class="card">
            <div class="text-gradient mb-md" style="font-size: 3rem;">3</div>
            <h3>Watch It Shine</h3>
            <p>Send 1 USD worth of SOL. Your star appears instantly in the universe.</p>
          </div>
        </div>
      </div>
    </section>
    
    <!-- About TSPILL -->
    <section id="about" class="section">
      <div class="container">
        <h2 class="text-center">Powered by TSPILL</h2>
        <p class="lead text-center mb-xl">The currency for creators, innovators & designers</p>
        
        <div class="grid">
          <div class="card">
            <h3>üéØ The Vision</h3>
            <p>TSPILL connects creators with vetted manufacturers to turn concepts into real products with proper attribution and rewards.</p>
          </div>
          
          <div class="card">
            <h3>üíé Token Utility</h3>
            <ul style="margin-left: 1.5rem;">
              <li>Access creator calls & submissions</li>
              <li>Incentivize participation</li>
              <li>Pay fees & get discounts</li>
              <li>Signal what to launch next</li>
            </ul>
          </div>
          
          <div class="card">
            <h3>üöÄ Why Universe?</h3>
            <p>This universe project funds the initial liquidity pool and builds our founding community of 500 star-lighters.</p>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Transparency -->
    <section id="transparency" class="section">
      <div class="container">
        <h2 class="text-center">Complete Transparency</h2>
        
        <div class="grid">
          <div class="card">
            <h3>üîí Live Treasury</h3>
            <p class="mono" style="word-break: break-all; font-size: 0.9rem;">
              Treasury: DgNqpvhNEhEKrc3wUKRccP1S2iUPFgaKbVqik7QmmYTK
            </p>
            <p class="mt-md">100% of funds are visible on-chain. Every dollar builds our liquidity pool.</p>
          </div>
          
          <div class="card">
            <h3>üìà Real-time Stats</h3>
            <p>Watch our growth live. Every star, every dollar, every participant is counted publicly.</p>
            <div class="mt-lg">
              <div class="loading" style="display: inline-block;"></div>
              <span style="margin-left: 8px;">Updating live...</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <p class="mb-md">¬© 2024 TSPILL Universe. All feelings welcome.</p>
        <p style="font-size: 0.875rem;">
          This is an experimental art project. No financial returns are promised or guaranteed.
          Connect responsibly.
        </p>
      </div>
    </div>
  </footer>
  
  <!-- Star Creation Modal -->
  <div id="starModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚ú® Light Your Star</h2>
        <button class="modal-close" onclick="closeStarModal()">√ó</button>
      </div>
      
      <div class="form-group">
        <label class="form-label">Your Feeling</label>
        <textarea 
          id="feelingInput"
          class="form-textarea"
          placeholder="What's in your heart? Share your wish, fear, dream, or thought..."
          maxlength="500"
          rows="4"
        ></textarea>
        <div class="mt-sm" style="color: var(--gray); font-size: 0.875rem;">
          <span id="charCount">0</span>/500 characters
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Display Name (Optional)</label>
        <input 
          type="text"
          id="displayName"
          class="form-input"
          placeholder="Anonymous, your name, or initials"
          maxlength="50"
        />
      </div>
      
      <div class="form-group">
        <label class="form-label">Cost: 1 USD ‚âà <span id="solAmount">0.004 SOL</span></label>
        <p style="color: var(--gray); font-size: 0.875rem;">
          Current SOL price fetched live. Transaction fee ~$0.01.
        </p>
      </div>
      
      <button id="createStarBtn" class="btn" style="width: 100%;" onclick="createStar()">
        <span id="btnText">üí´ Light My Star for 1 USD</span>
        <span id="btnLoading" class="loading hidden"></span>
      </button>
      
      <div id="transactionStatus" class="mt-lg" style="min-height: 24px;"></div>
    </div>
  </div>
  
  <!-- JavaScript -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
  
  <script>
    // ===== GLOBAL STATE =====
    let walletProvider = null;
    let connection = null;
    let stars = [];
    let localStars = [];
    
    // ===== CONSTANTS =====
    const TREASURY_ADDRESS = "DgNqpvhNEhEKrc3wUKRccP1S2iUPFgaKbVqik7QmmYTK";
    
    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('Initializing TSPILL Universe...');
      
      // Initialize connection
      try {
        connection = new solanaWeb3.Connection(
          "https://api.mainnet-beta.solana.com",
          'confirmed'
        );
        console.log('Solana connection established');
      } catch (error) {
        console.error('Failed to connect to Solana:', error);
        showToast('Network connection issue. Please refresh.', 'error');
      }
      
      // Create background particles
      createStarParticles();
      
      // Load existing stars
      loadStars();
      
      // Update live stats
      updateLiveStats();
      
      // Start live updates
      setInterval(updateLiveStats, 10000);
      
      // Setup event listeners
      setupEventListeners();
      
      console.log('Initialization complete');
    });
    
    // ===== EVENT LISTENERS SETUP =====
    function setupEventListeners() {
      // Wallet button
      document.getElementById('walletBtn').addEventListener('click', handleWalletConnection);
      
      // Light star button
      document.getElementById('lightStarBtn').addEventListener('click', openStarModal);
      
      // Character count
      document.getElementById('feelingInput').addEventListener('input', function() {
        document.getElementById('charCount').textContent = this.value.length;
      });
      
      // Close modal on outside click
      document.getElementById('starModal').addEventListener('click', (e) => {
        if (e.target.id === 'starModal') closeStarModal();
      });
    }
    
    // ===== STARFIELD MANAGEMENT =====
    function createStarParticles() {
      const container = document.getElementById('starParticles');
      for (let i = 0; i < 80; i++) {
        const particle = document.createElement('div');
        particle.className = 'star-particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.width = `${Math.random() * 2 + 1}px`;
        particle.style.height = particle.style.width;
        particle.style.animationDuration = `${Math.random() * 5 + 3}s`;
        particle.style.animationDelay = `${Math.random() * 5}s`;
        container.appendChild(particle);
      }
    }
    
    function loadStars() {
      // Load from localStorage
      const saved = localStorage.getItem('tspillUniverseStars');
      if (saved) {
        try {
          localStars = JSON.parse(saved);
          console.log('Loaded', localStars.length, 'stars from storage');
        } catch (e) {
          localStars = [];
          console.error('Error loading stars:', e);
        }
      }
      
      // Create initial demo stars (only if no user stars exist)
      if (localStars.length === 0) {
        const demoStars = [
          { x: 20, y: 30, text: "Hope is the thing with feathers", name: "Emily" },
          { x: 60, y: 20, text: "To the moon! üöÄ", name: "CryptoMax" },
          { x: 40, y: 60, text: "Be kind to yourself today", name: "Anonymous" },
          { x: 80, y: 40, text: "Build the future you want to see", name: "Builder" },
          { x: 30, y: 70, text: "Love conquers all", name: "Romantic" },
          { x: 70, y: 80, text: "Stay curious", name: "Explorer" }
        ];
        
        demoStars.forEach(star => {
          localStars.push({ ...star, isDemo: true });
        });
        
        // Save demo stars
        localStorage.setItem('tspillUniverseStars', JSON.stringify(localStars));
      }
      
      const container = document.getElementById('starfield');
      
      // Add all stars to display
      localStars.forEach(star => {
        createStarElement(star.x, star.y, star.text, star.name, star.isDemo || false);
      });
      
      updateStarCount();
    }
    
    function createStarElement(x, y, text, name, isDemo = false) {
      const container = document.getElementById('starfield');
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = `${x}%`;
      star.style.top = `${y}%`;
      star.style.animationDuration = `${10 + Math.random() * 10}s`;
      star.style.animationDelay = `${Math.random() * 5}s`;
      
      if (!isDemo) {
        star.title = `${name}: ${text}`;
        star.onclick = () => showStarDetails(text, name);
      } else {
        star.title = `Demo: ${text}`;
      }
      
      container.appendChild(star);
      stars.push(star);
      return star;
    }
    
    // ===== WALLET CONNECTION (SIMPLE & WORKING) =====
    async function handleWalletConnection() {
      console.log('Wallet connection requested');
      
      // Check if we're in a browser that supports Phantom
      if (typeof window === 'undefined') {
        showToast('Please use a modern browser', 'error');
        return;
      }
      
      // Check if Phantom is available
      if (window.solana && window.solana.isPhantom) {
        try {
          const provider = window.solana;
          
          // Check if already connected
          if (!provider.isConnected) {
            // Request connection
            await provider.connect();
            walletProvider = provider;
            
            updateWalletButton();
            showToast('‚úÖ Wallet connected successfully!', 'success');
            
            console.log('Connected to:', provider.publicKey.toString());
          } else {
            // Already connected
            walletProvider = provider;
            updateWalletButton();
            showToast('Wallet already connected', 'info');
          }
        } catch (error) {
          console.error('Connection error:', error);
          
          if (error.code === 4001) {
            showToast('Connection rejected by user', 'error');
          } else {
            showToast('Failed to connect wallet: ' + error.message, 'error');
          }
        }
      } else {
        // Phantom not detected
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isMobile) {
          // Mobile - show instructions
          const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
          if (isIOS) {
            showToast('üì± Please open this site in the Phantom app', 'info');
            setTimeout(() => {
              window.location.href = 'https://apps.apple.com/app/phantom-solana-wallet/id1598432977';
            }, 2000);
          } else {
            showToast('üì± Please open this site in the Phantom app', 'info');
            setTimeout(() => {
              window.location.href = 'https://play.google.com/store/apps/details?id=app.phantom';
            }, 2000);
          }
        } else {
          // Desktop - redirect to install Phantom
          showToast('üëª Please install Phantom wallet', 'info');
          setTimeout(() => {
            window.open('https://phantom.app/', '_blank');
          }, 1500);
        }
      }
    }
    
    function updateWalletButton() {
      const btn = document.getElementById('walletBtn');
      const text = document.getElementById('walletText');
      
      if (walletProvider && walletProvider.publicKey) {
        const addr = walletProvider.publicKey.toString();
        btn.classList.add('connected');
        text.textContent = `${addr.slice(0, 4)}...${addr.slice(-4)}`;
      } else {
        btn.classList.remove('connected');
        text.textContent = 'Connect Wallet';
      }
    }
    
    // ===== MODAL MANAGEMENT =====
    function openStarModal() {
      console.log('Opening star modal');
      
      if (!walletProvider) {
        showToast('Please connect your wallet first', 'warning');
        // Try to connect automatically
        handleWalletConnection();
        return;
      }
      
      // Update SOL amount display
      updateSolAmount();
      
      // Show modal
      document.getElementById('starModal').classList.add('active');
      document.getElementById('feelingInput').focus();
    }
    
    function closeStarModal() {
      document.getElementById('starModal').classList.remove('active');
      document.getElementById('feelingInput').value = '';
      document.getElementById('displayName').value = '';
      document.getElementById('charCount').textContent = '0';
      document.getElementById('transactionStatus').innerHTML = '';
      
      // Reset button
      const btn = document.getElementById('createStarBtn');
      const btnText = document.getElementById('btnText');
      const loading = document.getElementById('btnLoading');
      btn.disabled = false;
      btnText.textContent = 'üí´ Light My Star for 1 USD';
      loading.classList.add('hidden');
    }
    
    // ===== STAR CREATION =====
    async function createStar() {
      console.log('Creating star...');
      
      const feeling = document.getElementById('feelingInput').value.trim();
      const name = document.getElementById('displayName').value.trim() || 'Anonymous';
      
      // Validation
      if (!feeling) {
        showToast('Please write your feeling first', 'warning');
        return;
      }
      
      if (feeling.length > 500) {
        showToast('Message too long (max 500 chars)', 'warning');
        return;
      }
      
      if (!walletProvider) {
        showToast('Wallet not connected', 'error');
        return;
      }
      
      // Update button state
      const btn = document.getElementById('createStarBtn');
      const btnText = document.getElementById('btnText');
      const loading = document.getElementById('btnLoading');
      btn.disabled = true;
      btnText.textContent = 'Processing...';
      loading.classList.remove('hidden');
      
      try {
        // ===== 1. CALCULATE SOL AMOUNT =====
        // Use realistic SOL amount (~0.004 SOL for $1 at current prices)
        const SOL_PER_USD = 0.004;
        const FEE_BUFFER = 0.000005; // Small fee buffer
        
        const solAmount = SOL_PER_USD + FEE_BUFFER;
        const lamports = Math.round(solAmount * solanaWeb3.LAMPORTS_PER_SOL);
        
        console.log('Sending', solAmount, 'SOL (', lamports, 'lamports)');
        
        // ===== 2. CHECK WALLET BALANCE =====
        const balance = await connection.getBalance(walletProvider.publicKey);
        console.log('Wallet balance:', balance / solanaWeb3.LAMPORTS_PER_SOL, 'SOL');
        
        if (balance < lamports) {
          throw new Error(`Insufficient SOL balance. You need ~${solAmount.toFixed(6)} SOL (including fees).`);
        }
        
        // ===== 3. CREATE TRANSACTION =====
        const treasuryPubkey = new solanaWeb3.PublicKey(TREASURY_ADDRESS);
        
        const transaction = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: walletProvider.publicKey,
            toPubkey: treasuryPubkey,
            lamports: lamports
          })
        );
        
        // ===== 4. GET RECENT BLOCKHASH =====
        const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash();
        transaction.recentBlockhash = blockhash;
        transaction.feePayer = walletProvider.publicKey;
        
        // ===== 5. SIGN TRANSACTION =====
        console.log('Requesting signature...');
        showTransactionStatus('Please approve the transaction in your wallet...', 'info');
        
        let signed;
        try {
          signed = await walletProvider.signTransaction(transaction);
        } catch (signError) {
          console.error('Sign error:', signError);
          if (signError.message?.includes('rejected') || signError.message?.includes('declined')) {
            throw new Error('Transaction rejected by user');
          }
          throw signError;
        }
        
        // ===== 6. SEND TRANSACTION =====
        console.log('Sending transaction...');
        showTransactionStatus('Sending transaction...', 'info');
        
        const signature = await connection.sendRawTransaction(signed.serialize(), {
          skipPreflight: false,
          preflightCommitment: 'confirmed'
        });
        
        console.log('Transaction sent, signature:', signature);
        
        // ===== 7. CONFIRM TRANSACTION =====
        showTransactionStatus('Confirming transaction... This may take a few seconds.', 'info');
        
        const confirmation = await connection.confirmTransaction({
          signature,
          blockhash,
          lastValidBlockHeight
        }, 'confirmed');
        
        console.log('Confirmation:', confirmation);
        
        if (confirmation.value.err) {
          throw new Error(`Transaction failed: ${JSON.stringify(confirmation.value.err)}`);
        }
        
        // ===== 8. SUCCESS - CREATE STAR =====
        const x = Math.random() * 90 + 5;
        const y = Math.random() * 90 + 5;
        
        const star = { 
          x, 
          y, 
          text: feeling, 
          name, 
          timestamp: Date.now(), 
          tx: signature,
          solAmount: solAmount
        };
        
        // Save to localStorage
        localStars.push(star);
        localStorage.setItem('tspillUniverseStars', JSON.stringify(localStars));
        
        // Add to starfield
        createStarElement(x, y, feeling, name, false);
        
        // Update stats
        updateStarCount();
        
        // Show success
        showTransactionStatus(
          `‚úÖ Success! Your star is now in the universe!<br>
           <small>Transaction: ${signature.slice(0, 12)}...</small>`,
          'success'
        );
        
        showToast('‚ú® Your star has been added to the universe!', 'success');
        
        // Close modal after delay
        setTimeout(() => {
          closeStarModal();
          
          // Highlight the new star briefly
          highlightNewStar(x, y);
        }, 2000);
        
      } catch (error) {
        console.error('Transaction error:', error);
        
        // User-friendly error messages
        let errorMessage = 'Transaction failed. Please try again.';
        
        if (error.message.includes('rejected')) {
          errorMessage = 'Transaction was rejected by your wallet.';
        } else if (error.message.includes('Insufficient')) {
          errorMessage = error.message;
        } else if (error.message.includes('429') || error.message.includes('rate limit')) {
          errorMessage = 'Network busy. Please try again in a moment.';
        } else if (error.message.includes('blockhash')) {
          errorMessage = 'Network error. Please refresh and try again.';
        } else if (error.message.includes('timeout')) {
          errorMessage = 'Transaction timeout. Please try again.';
        }
        
        showTransactionStatus(`‚ùå ${errorMessage}`, 'error');
        showToast(errorMessage, 'error');
        
        // Reset button
        btn.disabled = false;
        btnText.textContent = 'üí´ Light My Star for 1 USD';
        loading.classList.add('hidden');
      }
    }
    
    // ===== HELPER FUNCTIONS =====
    function showTransactionStatus(message, type = 'info') {
      const statusEl = document.getElementById('transactionStatus');
      const colors = {
        success: 'var(--success)',
        error: 'var(--error)',
        warning: 'var(--warning)',
        info: 'var(--primary)'
      };
      
      statusEl.innerHTML = `
        <div style="color: ${colors[type]}; padding: 8px; border-radius: 8px;">
          ${message}
        </div>
      `;
    }
    
    function highlightNewStar(x, y) {
      const stars = document.querySelectorAll('.star');
      stars.forEach(star => {
        const starX = parseFloat(star.style.left);
        const starY = parseFloat(star.style.top);
        
        // Find the star at this position (approximately)
        if (Math.abs(starX - x) < 0.1 && Math.abs(starY - y) < 0.1) {
          star.style.animation = 'pulse 1s ease 3';
          star.style.boxShadow = '0 0 40px rgba(212, 165, 116, 1)';
          
          setTimeout(() => {
            star.style.animation = '';
            star.style.boxShadow = '';
          }, 3000);
        }
      });
    }
    
    // Add pulse animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.5); }
        100% { transform: scale(1); }
      }
    `;
    document.head.appendChild(style);
    
    function updateSolAmount() {
      // For now, show fixed amount
      // In production, you'd fetch live price
      document.getElementById('solAmount').textContent = '~0.004 SOL';
    }
    
    function updateStarCount() {
      const totalStars = stars.length;
      const userStars = localStars.filter(s => !s.isDemo).length;
      const totalRaised = (userStars * 1).toFixed(2);
      
      document.getElementById('totalStars').textContent = totalStars;
      document.getElementById('totalRaised').textContent = `$${totalRaised}`;
    }
    
    function updateLiveStats() {
      // Simulate live users (in real app, this would come from backend)
      const liveUsers = Math.floor(Math.random() * 30) + 5;
      document.getElementById('liveUsers').textContent = liveUsers;
    }
    
    function showStarDetails(text, name) {
      showToast(`<strong>${name}:</strong> ${text.substring(0, 100)}${text.length > 100 ? '...' : ''}`, 'info');
    }
    
    // ===== TOAST NOTIFICATION SYSTEM =====
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = message;
      document.body.appendChild(toast);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }, 5000);
      
      // Click to dismiss
      toast.onclick = () => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      };
    }
    
    // ===== SMOOTH SCROLLING =====
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
          
          // Update active nav link
          document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
          });
          this.classList.add('active');
        }
      });
    });
    
    // Update active nav on scroll
    window.addEventListener('scroll', () => {
      const sections = document.querySelectorAll('section');
      const navLinks = document.querySelectorAll('.nav-link');
      
      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (pageYOffset >= sectionTop - 100) {
          current = section.getAttribute('id');
        }
      });
      
      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${current}`) {
          link.classList.add('active');
        }
      });
    });
    
    // ===== ERROR HANDLING =====
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
      showToast('An error occurred. Please refresh the page.', 'error');
    });
    
    window.addEventListener('unhandledrejection', function(e) {
      console.error('Unhandled promise rejection:', e.reason);
      showToast('A network error occurred. Please try again.', 'error');
    });
  </script>
</body>
</html>
