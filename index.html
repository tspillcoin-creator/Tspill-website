<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSPILL â€” Identity Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>

    <style>
        /* Your original styles remain exactly the same */
        :root { --gold: #d4af37; --bg: #050505; --card-white: #ffffff; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: #000; font-family: 'Space Grotesk', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #bg-canvas { position: fixed; inset: 0; z-index: 1; opacity: 0.9; }
        .gate-card { position: relative; z-index: 10; width: 440px; padding: 80px 50px; background: var(--card-white); text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        /* ... keeping all your existing CSS ... */
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>

    <div class="gate-card">
        <h1 style="letter-spacing: 4px; margin-bottom: 40px; font-weight: 700;">TSPILL</h1>
        
        <div id="input-section">
            <input type="text" id="user-name" placeholder="INITIATE IDENTITY" style="width:100%; padding:15px; border:1px solid #ddd; margin-bottom:20px; text-align:center; font-family:inherit;">
            <button onclick="generateProtocol()" style="width:100%; padding:15px; background:#000; color:#fff; border:none; cursor:pointer; font-weight:700;">GENERATE ID</button>
        </div>

        <div id="id-display" style="display:none; margin-top:30px; border-top:1px solid #eee; padding-top:20px;">
            <p style="font-size:0.8rem; color:#888;">PROTOCOL ESTABLISHED</p>
            <h2 id="final-id" style="color:var(--gold); margin:10px 0; letter-spacing:2px;"></h2>
            <button onclick="enterEcosystem()" style="margin-top:20px; padding:10px 20px; background:none; border:1px solid #000; cursor:pointer;">ENTER ECOSYSTEM</button>
        </div>
    </div>

    <script>
        // 2. YOUR UNIQUE FIREBASE CONFIG (Added)
        const firebaseConfig = {
            apiKey: "AIzaSyC8ijxZRv6zPUctap5Ui75Jh0sCdW0C5Do",
            authDomain: "tspill-registry.firebaseapp.com",
            projectId: "tspill-registry",
            storageBucket: "tspill-registry.firebasestorage.app",
            messagingSenderId: "723181242600",
            appId: "1:723181242600:web:8db3b828566c4c0845a15d",
            measurementId: "G-JG5EGN4F90"
        };

        // 3. INITIALIZE THE CLOUD
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 4. GENERATE & SAVE TO CLOUD (Updated from LocalStorage)
        async function generateProtocol() {
            const name = document.getElementById('user-name').value;
            if(!name) return alert("Identify yourself.");

            const generatedID = "TSP-" + Math.random().toString(36).substr(2, 6).toUpperCase();

            try {
                // This saves the ID to Google's Cloud instead of your computer
                await db.collection("identities").add({
                    userName: name,
                    protocolID: generatedID,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                document.getElementById('final-id').innerText = generatedID;
                document.getElementById('input-section').style.display = 'none';
                document.getElementById('id-display').style.display = 'block';
                
                // We still save the ID locally for the next page to "remember" who you are
                localStorage.setItem('currentTSP_ID', generatedID); 
            } catch (error) {
                console.error("Cloud Error: ", error);
                alert("Identity Protocol Failed to reach Cloud.");
            }
        }

        function enterEcosystem() {
            window.location.href = 'home.html';
        }

        // --- Your original background animation logic remains below ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        // ... (rest of your animation code)
    </script>
</body>
</html>
