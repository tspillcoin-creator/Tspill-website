<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TSPILL — Entry</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg-deep: #000000; 
      --card-bg: #ffffff; 
      --text-main: #1a1c20;
      --text-muted: #4a5568;
      --gold: #d4a055;
      --border: rgba(0, 0, 0, 0.08);
      --gradient-gold: linear-gradient(135deg,#d4a055,#f0c87a,#a67c3d);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-deep);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      overflow: hidden;
      padding: 40px 20px;
    }

    canvas#bg { position: fixed; inset: 0; z-index: 1; }
    .spacer { height: 1px; width: 100%; visibility: hidden; }

    .portal-box {
      background: var(--card-bg);
      border: 1px solid rgba(255,255,255,0.1);
      padding: 60px 40px;
      border-radius: 28px;
      width: 100%;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 30px 100px rgba(0,0,0,0.6);
      z-index: 10;
      position: relative;
    }

    .logo-container img { 
      width: 85px; height: 85px; border-radius: 20px; margin-bottom: 24px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    
    h1.brand-title { 
      font-family: 'Space Grotesk', sans-serif; font-size: 2.5rem; 
      margin-bottom: 8px; letter-spacing: 0.05em;
      background: var(--gradient-gold); -webkit-background-clip: text;
      -webkit-text-fill-color: transparent; font-weight: 700;
    }

    p.tagline { 
      color: var(--text-muted); font-size: 0.85rem; margin-bottom: 35px; 
      text-transform: uppercase; letter-spacing: 0.1em; font-weight: 500;
    }

    input[type="email"] {
      width: 100%; padding: 16px 20px; border-radius: 12px; 
      border: 1px solid var(--border); background: #f8f9fa;
      font-size: 1rem; margin-bottom: 15px; outline: none; transition: 0.3s;
    }
    
    input[type="email"]:focus { border-color: var(--gold); background: #fff; }

    .btn {
      width: 100%; padding: 16px; border-radius: 12px; border: none; 
      font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; 
      cursor: pointer; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 0.8rem; margin-bottom: 12px;
    }

    .btn-email { background: var(--text-main); color: #fff; }
    .btn-wallet { background: transparent; border: 1.5px solid var(--gold); color: var(--gold); }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.2); }

    footer { 
      position: relative; font-size: 0.75rem; color: rgba(255,255,255,0.4); 
      letter-spacing: 0.4em; text-transform: uppercase; z-index: 10; margin-top: 60px;
    }
  </style>
</head>
<body>

<canvas id="bg"></canvas>
<div class="spacer"></div>

<div class="portal-box">
  <div class="logo-container">
    <img src="./Tea_spill_logo.png" alt="TSPILL Logo">
  </div>
  
  <h1 class="brand-title">TSPILL</h1>
  <p class="tagline">Production-Linked Creative Ecosystem</p>

  <div class="input-group">
    <input type="email" id="emailInput" placeholder="ENTER CREATOR EMAIL">
    <button class="btn btn-email" onclick="enterWithEmail()">Enter System</button>
    <button class="btn btn-wallet" id="walletButton" onclick="connectWallet()">Connect Wallet</button>
  </div>
</div>

<footer>TSPILL™</footer>

<script>
  // HIGH-VISIBILITY GOLD ANIMATION
  const c = document.getElementById("bg"), ctx = c.getContext("2d");
  function resize() { c.width = innerWidth; c.height = innerHeight; }
  window.addEventListener("resize", resize); resize();

  const pts=[...Array(100)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,vx:(Math.random()-.5)*.35,vy:(Math.random()-.5)*.35}));
  function animate(){
    ctx.clearRect(0,0,c.width,c.height);
    for(let i=0;i<pts.length;i++){
      const p=pts[i];p.x+=p.vx;p.y+=p.vy;
      if(p.x<0||p.x>c.width)p.vx*=-1;if(p.y<0||p.y>c.height)p.vy*=-1;
      for(let j=i+1;j<pts.length;j++){
        const q=pts[j];const d=Math.hypot(p.x-q.x,p.y-q.y);
        if(d<210){ctx.strokeStyle=`rgba(212,160,85,${(1-d/210)*0.85})`;ctx.lineWidth=1.3;ctx.beginPath();ctx.moveTo(p.x,p.y);ctx.lineTo(q.x,q.y);ctx.stroke();}
      }
      ctx.fillStyle="rgba(212,160,85,0.95)";ctx.beginPath();ctx.arc(p.x,p.y,2.5,0,Math.PI*2);ctx.fill();
    }
    requestAnimationFrame(animate);
  }
  animate();

  // LOGIN LOGIC
  function enterWithEmail() {
    const email = document.getElementById("emailInput").value;
    if (!email) { alert("Please enter an email"); return; }
    localStorage.setItem("tspill_user_id", email);
    localStorage.setItem("tspill_login_type", "email");
    window.location.href = "home.html";
  }

  async function connectWallet() {
    // 1. Detection: Check for Phantom in various injection points
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const provider = window?.phantom?.solana || window?.solana;

    if (provider?.isPhantom) {
      try {
        const resp = await provider.connect();
        const address = resp.publicKey.toString();
        
        // 2. Success: Save and Redirect
        localStorage.setItem("tspill_user_id", address);
        localStorage.setItem("tspill_login_type", "wallet");
        window.location.href = "home.html";
      } catch (err) {
        console.warn("User cancelled connection");
      }
    } else {
      // 3. Fallback: Handling missing extension or Mobile Browser
      if (isMobile) {
        // Force the Phantom App to open our site in its internal browser
        const currentUrl = encodeURIComponent(window.location.href);
        window.location.href = `https://phantom.app/ul/v1/browse/${currentUrl}?ref=${encodeURIComponent(window.location.origin)}`;
      } else {
        // Desktop user with no extension
        window.open("https://phantom.app/", "_blank");
        alert("Phantom not found. Please install the extension or use the Mobile Phantom Browser.");
      }
    }
  }
</script>

</body>
</html>
