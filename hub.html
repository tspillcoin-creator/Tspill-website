<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TSPILL â€” Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
 --gold:#d4af37;
 --bg:#000;
 --panel:#050505;
 --grid:#0f0f0f;
 --border:rgba(212,175,55,.25);
}

*{box-sizing:border-box;margin:0;padding:0}

body{
 background:var(--bg);
 color:#fff;
 font-family:Inter,system-ui;
 height:100vh;
 overflow:hidden;
}

/* BACKGROUND */
#bg-canvas{position:fixed;inset:0;z-index:0}
.watermark{
 position:fixed;inset:0;
 display:flex;align-items:center;justify-content:center;
 font-size:9vw;font-family:Space Grotesk;font-weight:700;
 color:rgba(255,255,255,.02);letter-spacing:8px;z-index:1;
}

/* TOP META */
.top-meta{
 position:fixed;top:16px;right:40px;z-index:5;
 font-size:12px;letter-spacing:1px;color:var(--gold);
}

/* LAYOUT */
.hub{display:flex;height:100vh;position:relative;z-index:2}

/* GRID */
.grid-wrap{
 flex:1;
 padding:100px 80px 120px;
 overflow-y:auto;
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
 gap:28px;
}

/* CARD */
.intent-card{
 background:var(--grid);
 border:1px solid rgba(255,255,255,.06);
 padding:14px;
 height:120px;
 cursor:pointer;
 transition:.2s;
 position:relative;
}
.intent-card:hover{border-color:var(--gold)}
.intent-id{font-size:11px;color:#aaa}
.intent-stage{
 position:absolute;bottom:12px;right:12px;
 font-size:10px;color:var(--gold)
}
.intent-thumb{
 margin-top:10px;height:46px;background:#111;opacity:.35
}

/* SIDE PANEL */
.side-panel{
 width:0;background:var(--panel);
 border-left:1px solid var(--border);
 overflow:hidden;transition:.25s;
}
.side-panel.open{width:380px}
.panel-inner{
 height:100%;overflow-y:auto;padding:28px
}
.panel-inner h2{
 font-family:Space Grotesk;font-size:1.1rem;margin-bottom:14px
}
.section{margin-bottom:26px;font-size:13px;color:#ccc}
.section span{color:var(--gold)}
button{
 background:none;border:1px solid var(--gold);
 color:var(--gold);padding:6px 10px;cursor:pointer
}

/* PLUS */
.plus-wrap{
 position:fixed;bottom:40px;left:50%;
 transform:translateX(-50%);z-index:6
}
.plus-btn{
 width:60px;height:60px;border-radius:50%;
 border:1px solid var(--gold);color:var(--gold);
 background:transparent;font-size:28px
}
.rotate-text{
 position:absolute;inset:-22px;border-radius:50%;
 border:1px dashed rgba(212,175,55,.35);
 animation:spin 12s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}

/* MODAL */
.modal{
 position:fixed;inset:0;background:rgba(0,0,0,.8);
 display:none;align-items:center;justify-content:center;z-index:10
}
.modal-box{
 background:#050505;border:1px solid var(--border);
 padding:30px;width:360px
}
.modal-box input,textarea{
 width:100%;background:#000;border:1px solid #333;
 color:#fff;padding:8px;margin-bottom:14px
}
</style>
</head>

<body>

<canvas id="bg-canvas"></canvas>
<div class="watermark">PUBLIC LEDGER</div>

<div class="top-meta" id="metaLine"></div>

<div class="hub">
 <div class="grid-wrap" id="grid"></div>

 <div class="side-panel" id="panel">
  <div class="panel-inner" id="panelContent"></div>
 </div>
</div>

<div class="plus-wrap">
 <div class="rotate-text"></div>
 <button class="plus-btn" onclick="openModal()">+</button>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
 <div class="modal-box">
  <h3 style="margin-bottom:12px">Declare Intent</h3>
  <input id="intentTitle" placeholder="Intent title">
  <textarea id="intentDesc" placeholder="Intent description"></textarea>
  <button onclick="createIntent()">Log Intent</button>
 </div>
</div>

<script>
/* ID */
const creatorId=localStorage.getItem("TSPILL_ID");
if(!creatorId)location.href="index.html";
metaLine.textContent=`Creator: ${creatorId} | State: Active | Signals: 0`;

/* DATA */
let intents=[];
let openId=null;

/* GRID */
function renderGrid(){
 grid.innerHTML="";
 intents.forEach(i=>{
  const d=document.createElement("div");
  d.className="intent-card";
  d.innerHTML=`
   <div class="intent-id">${i.id}</div>
   ${i.image?'<div class="intent-thumb"></div>':''}
   <div class="intent-stage">Stage ${i.stage}</div>
  `;
  d.onclick=()=>togglePanel(i);
  grid.appendChild(d);
 });
}

/* PANEL */
function togglePanel(i){
 if(openId===i.id){panel.classList.remove("open");openId=null;return}
 openId=i.id;panel.classList.add("open");
 panelContent.innerHTML=`
  <h2>${i.id}</h2>
  <div class="section"><span>Stage:</span> ${stageLabel(i.stage)}</div>
  <div class="section"><span>Description:</span><br>${i.desc}</div>
  ${i.stage===2&&!i.image?`
   <div class="section">
    <span>Reference Image</span><br>
    <input type="file" onchange="attachImage('${i.id}')">
   </div>`:""}
  ${i.image?`<div class="section"><span>Image attached</span></div>`:""}
 `;
}

/* MODAL */
function openModal(){modal.style.display="flex"}
modal.onclick=e=>{if(e.target===modal)modal.style.display="none"}

/* CREATE */
function createIntent(){
 const t=intentTitle.value.trim();
 const d=intentDesc.value.trim();
 if(!t||!d)return;
 intents.push({
  id:"INT-"+(intents.length+1).toString().padStart(3,"0"),
  stage:2,desc:d,image:false
 });
 modal.style.display="none";
 intentTitle.value="";intentDesc.value="";
 renderGrid();
}

/* IMAGE */
function attachImage(id){
 const i=intents.find(x=>x.id===id);
 if(i){i.image=true;renderGrid();togglePanel(i)}
}

/* STAGE LABEL */
function stageLabel(s){
 return{
 0:"Declared",
 1:"Logged",
 2:"Under Observation",
 3:"External Interest Detected",
 4:"Execution Path Open",
 5:"Archived"
 }[s];
}

/* BG */
const c=bg-canvas,x=c.getContext("2d");let pts=[];
function init(){c.width=innerWidth;c.height=innerHeight;
 pts=[...Array(50)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,
 vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3}))}
function draw(){
 x.clearRect(0,0,c.width,c.height);
 pts.forEach((p,i)=>{
  p.x+=p.vx;p.y+=p.vy;
  if(p.x<0||p.x>c.width)p.vx*=-1;
  if(p.y<0||p.y>c.height)p.vy*=-1;
  for(let j=i+1;j<pts.length;j++){
   const q=pts[j],d=Math.hypot(p.x-q.x,p.y-q.y);
   if(d<160){
    x.strokeStyle=`rgba(212,175,55,${.25*(1-d/160)})`;
    x.beginPath();x.moveTo(p.x,p.y);x.lineTo(q.x,q.y);x.stroke();
   }
  }
 });
 requestAnimationFrame(draw);
}
addEventListener("resize",init);init();draw();
</script>

</body>
</html>
